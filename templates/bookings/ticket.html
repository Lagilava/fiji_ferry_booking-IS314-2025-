{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1 class="text-3xl font-bold text-center mb-8">⛴ Fiji Ferry Booking – Your Tickets</h1>

<div class="grid gap-6 max-w-3xl mx-auto">
    {% for ticket in booking.tickets.all %}
    <div class="bg-white shadow-xl rounded-2xl border border-gray-200 p-6 relative overflow-hidden">

        <!-- Ticket Header -->
        <div class="flex justify-between items-center border-b border-dashed pb-4 mb-4">
            <h2 class="text-xl font-bold">🎟 Boarding Pass</h2>
            <span class="text-sm font-semibold px-3 py-1 rounded-full
                         {% if ticket.ticket_status == 'confirmed' %}
                             bg-green-100 text-green-800
                         {% elif ticket.ticket_status == 'pending' %}
                             bg-yellow-100 text-yellow-800
                         {% else %}
                             bg-red-100 text-red-800
                         {% endif %}">
                {{ ticket.ticket_status|title }}
            </span>
        </div>

        <!-- Passenger -->
        <div class="mb-4">
            <h3 class="text-lg font-semibold mb-1">👤 Passenger</h3>
            <p class="text-gray-700">Type: {{ ticket.passenger.passenger_type|title }}</p>
        </div>

        <!-- Booking -->
        <div class="mb-4">
            <h3 class="text-lg font-semibold mb-1">📄 Booking</h3>
            <p class="text-gray-700">Booking ID: <span class="font-mono">#{{ ticket.booking.id }}</span></p>
            <p class="text-gray-700">Issued: {{ ticket.issued_at|date:"M d, Y H:i" }}</p>
        </div>

        <!-- Schedule -->
        <div class="mb-4">
            <h3 class="text-lg font-semibold mb-1">🛳 Schedule</h3>
            <p class="text-gray-700">Ferry: {{ ticket.booking.schedule.ferry.name }}</p>
            <p class="text-gray-700">Route: <strong>{{ ticket.booking.schedule.route.departure_port }}</strong> → <strong>{{ ticket.booking.schedule.route.destination_port }}</strong></p>
            <p class="text-gray-700">Departure: {{ ticket.booking.schedule.departure_time|date:"M d, Y H:i" }}</p>
            <p class="text-gray-700">Arrival: {{ ticket.booking.schedule.arrival_time|date:"M d, Y H:i" }}</p>
        </div>

        <!-- QR Code -->
        <div class="flex flex-col items-center mt-6">
            {% if ticket.qr_code %}
                <p class="text-sm text-gray-600 mb-2">✅ Present this QR code at boarding</p>
                <div class="bg-gray-100 p-3 rounded-xl">
                    <img src="{{ ticket.qr_code.url }}" alt="QR Code" class="w-40 h-40 object-contain">
                </div>
            {% else %}
                <p class="text-red-600 font-semibold">⚠️ QR Code not available for this ticket.</p>
            {% endif %}
        </div>

        <!-- Decorative Perforation -->
        <div class="absolute top-0 bottom-0 left-0 w-4 bg-gray-50 rounded-l-full border-r border-dashed border-gray-300"></div>
        <div class="absolute top-0 bottom-0 right-0 w-4 bg-gray-50 rounded-r-full border-l border-dashed border-gray-300"></div>
    </div>
    {% empty %}
    <p class="text-center text-gray-600">No tickets found for this booking.</p>
    {% endfor %}
</div>

<!-- Back / Download -->
<div class="text-center mt-8 space-x-4">
    <a href="{% url 'bookings:booking_history' %}"
       class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition">← Back</a>
    <a href="{% url 'bookings:booking_pdf' booking.id %}"
       class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
       ⬇ Download All Tickets (PDF)
    </a>
</div>
{% endblock %}
